<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Misioneros y Caníbales - Visual</title>
    <link href="/static/styles.css" rel="stylesheet">
    <script>
        let currentStep = 0;
        const steps = {{ nodes | tojson }};

        function renderPeople(container, m, c) {
            container.innerHTML = "";
            for (let i = 0; i < m; i++) {
                const el = document.createElement("div");
                el.textContent = "👨‍🦰";
                el.className = "bg-blue-100 rounded-full px-2 py-1 mx-1 shadow text-2xl";
                container.appendChild(el);
            }
            for (let i = 0; i < c; i++) {
                const el = document.createElement("div");
                el.textContent = "👹";
                el.className = "bg-red-100 rounded-full px-2 py-1 mx-1 shadow text-2xl";
                container.appendChild(el);
            }
        }

        function renderStep(step) {
            const left = document.getElementById("left");
            const right = document.getElementById("right");
            const boat = document.getElementById("boat");
            const message = document.getElementById("message");
            const resetBtn = document.getElementById("reset-btn");

            const state = steps[step];
            document.getElementById("step-count").textContent = "Paso: " + state.step;

            const [lm, lc] = state.left.split('M,').map(s => parseInt(s));
            const [rm, rc] = state.right.split('M,').map(s => parseInt(s));

            renderPeople(left, lm, lc);
            renderPeople(right, rm, rc);

            boat.textContent = "🚣";

            if (state.boat === 'left') {
                boat.style.left = "10%";
                boat.style.transform = "scaleX(1)";
            } else {
                boat.style.left = "60%";
                boat.style.transform = "scaleX(-1)";
            }

            if (step === steps.length - 1) {
                message.textContent = "🎉 ¡Juego completado!";
                resetBtn.disabled = false;
                resetBtn.classList.remove("opacity-50", "cursor-not-allowed");
            } else {
                message.textContent = "";
            }
        }

        function nextStep() {
            if (currentStep < steps.length - 1) {
                currentStep++;
                renderStep(currentStep);
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                renderStep(currentStep);
            }
        }

        function resetGame() {
            currentStep = 0;
            renderStep(currentStep);
            const resetBtn = document.getElementById("reset-btn");
            resetBtn.disabled = true;
            resetBtn.classList.add("opacity-50", "cursor-not-allowed");
            document.getElementById("message").textContent = "";
        }

        window.onload = () => renderStep(currentStep);
    </script>

</head>

<body class="bg-blue-100 min-h-screen flex flex-col items-center p-6">

    <h1 class="text-3xl font-bold text-center mb-6">🌊 Misioneros y Caníbales</h1>

    <div id="step-count" class="text-xl font-semibold mb-2">Paso: 0</div>

    <div id="message" class="mb-3 text-lg font-bold text-green-700"></div>

    <div
        class="flex items-center justify-center w-full max-w-5xl h-40 rounded-lg shadow-lg overflow-hidden border border-gray-300">
        <!-- Zona izquierda (pasto) -->
        <div id="left" class="w-1/3 h-full bg-green-200 flex justify-end items-center p-4 space-x-1 flex-wrap text-2xl">
            <!-- Personajes renderizados desde JS -->
        </div>

        <!-- Río -->
        <div class="w-1/3 h-full bg-blue-300 flex items-center justify-center relative">
            <div id="boat" class="absolute transition-all duration-700 text-4xl">
                🚣
            </div>
        </div>


        <!-- Zona derecha (pasto) -->
        <div id="right"
            class="w-1/3 h-full bg-green-200 flex justify-start items-center p-4 space-x-1 flex-wrap text-2xl">
            <!-- Personajes renderizados desde JS -->
        </div>
    </div>

    <div class="flex space-x-4 mt-6">
        <button onclick="prevStep()" class="bg-gray-700 hover:bg-gray-800 text-white px-4 py-2 rounded">⬅
            Anterior</button>
        <button onclick="nextStep()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Siguiente
            ➡</button>

        <button id="reset-btn" onclick="resetGame()"
            class="px-4 py-2 bg-blue-500 text-white rounded disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            🔁 Reiniciar Juego
        </button>

    </div>

</body>

</html>